<?php
/**
 * Secrets Configuration Template
 *
 * Copy this file to .secrets.php and fill in your actual values.
 * 
 * SECURITY REQUIREMENTS:
 * - config/.secrets.php should NEVER be committed to version control
 * - Generate new keys using: php keygenerator.php
 * - Ensure proper file permissions (e.g., chmod 600 config/.secrets.php)
 * - config/.secrets.php is listed in .gitignore */

// ============================================================================
// ENCRYPTION KEY
// ============================================================================
// This key is used to encrypt/decrypt user IDs (UidEncryptor)
// 
// IMPORTANT: This must be a 32-byte key encoded in base64 with 'base64:' prefix
// 
// To generate a new key, run:
//   php -r "echo 'base64:' . base64_encode(random_bytes(32)) . PHP_EOL;"
//
// Example output:
//   base64:YourRandomBase64EncodedKeyHere1234567890ABCDEF==
//
putenv('ENCRYPTION_KEY=base64:REPLACE_WITH_YOUR_GENERATED_KEY');

// Key to generate unique tokens
putenv('UNIQUE_KEY=base64:REPLACE_WITH_YOUR_GENERATED_KEY');

// ============================================================================
// WEBLING API CONFIGURATION
// ============================================================================
// Domain: Your Webling subdomain (without .webling.ch)
// Example: If your Webling URL is https://mycompany.webling.ch, use 'mycompany'
//
putenv('WEBLING_DOMAIN=your-domain');

// API Key: Your Webling API key
// You can find this in your Webling settings under API
//
putenv('WEBLING_API_KEY=your-api-key-here');

// ============================================================================
// SMTP CONFIGURATION (for sending authentication codes via email)
// ============================================================================
// SMTP Server Host
// Example: smtp.gmail.com, smtp.office365.com, mail.example.com
//
putenv('SMTP_HOST=smtp.example.com');

// SMTP Server Port
// Common ports: 
//   587 - TLS/STARTTLS (recommended for most providers)
//   465 - SSL (direct encrypted connection, legacy but still used)
//   25  - Plain text (not recommended, often blocked)
//
putenv('SMTP_PORT=587');

// SMTP Username (usually your email address)
//
putenv('SMTP_USERNAME=your-email@example.com');

// SMTP Password
//
putenv('SMTP_PASSWORD=your-smtp-password');

// From Email Address (sender)
//
putenv('SMTP_FROM_EMAIL=noreply@example.com');

// From Name (optional, sender display name)
//
putenv('SMTP_FROM_NAME=Authentication Service');

// Use TLS encryption (true/false, default: true)
// Note: TLS uses STARTTLS on an unencrypted connection
//
putenv('SMTP_USE_TLS=true');

// Use SSL encryption (true/false, default: false)
// Note: SSL uses direct encrypted connection, typically on port 465
// SSL takes precedence over TLS if both are enabled
//
putenv('SMTP_USE_SSL=false');

// ============================================================================
// API KEYS CONFIGURATION
// ============================================================================
// Define API keys with their complete configuration including routes, 
// rate limits and permissions. API keys are ONLY defined here - not in config.json.
// 
// To generate new API keys, run:
//   php keygenerator.php
//
// Configuration Options:
// - 'name': Descriptive name for the API key
// - 'permissions': Permission system (user_info, user_token, user_properties, delegate)
    - `user_info`: Access to GET /user/{session_id}/info (full user data)
    - `user_token`: Access to GET /user/{session_id}/token (encrypted Webling ID)
    - `user_id`: Access to GET /user/{session_id}/id (decrypted Webling user ID)
    - `user_properties`: Access to GET /user/{session_id}/properties (selective properties)
    - `membergroup_info`: Access to GET /membergroup/{session_id}/{membergroup_id} (membergroup data)
    - `membergroup_check`: Access to GET /membergroup/{session_id}/{name}/member/{user_id} (membership check)
    - `delegate_session`: Access to POST /session/delegate/{session_id} (create delegated sessions)
// - 'routes': Specific routes this key can access (overrides default routes)
// - 'rate_limit': Custom rate limiting (window_seconds, max_requests)
// - 'allowed_properties': Array of Webling user properties accessible via /properties route
//   (only applicable if user_properties permission is granted; if omitted, all properties allowed)
//
// Route Format: "METHOD:/path/with/{parameters}"
// Examples: "POST:/login", "GET:/session/check/{session_id}"
//
// IMPORTANT: Sessions can only be accessed by the same API key that created them
//
$API_KEYS = [
    'REPLACE_WITH_GENERATED_API_KEY_1' => [
        'name' => 'Main Application',
        'permissions' => ['user_info', 'user_token', 'user_properties', 'membergroup_info', 'membergroup_check', 'delegate'],
        'routes' => [
            'POST:/login',
            'POST:/validate/{session_id}',
            'GET:/session/check/{session_id}',
            'POST:/session/touch/{session_id}',
            'POST:/session/logout/{session_id}',
            'POST:/session/delegate/{session_id}',
            'GET:/user/{session_id}/info',
            'GET:/user/{session_id}/token',
            'GET:/user/{session_id}/properties',
            'GET:/membergroup/{session_id}/{membergroup_id}',
            'GET:/membergroup/{session_id}/{membergroup_name}/member/{user_id}'
        ],
        'rate_limit' => [
            'window_seconds' => 60,
            'max_requests' => 100
        ],
        // Optional: Restrict which user properties can be accessed
        // If not specified, all properties are allowed when user_properties permission is present
        'allowed_properties' => ['Vorname', 'Name', 'E-Mail', 'Telefon 1', 'Notizen']
    ],
    'REPLACE_WITH_GENERATED_API_KEY_2' => [
        'name' => 'Limited Application',
        'permissions' => [], // Only default routes allowed
        'routes' => [
            'POST:/login',
            'POST:/validate/{session_id}',
            'GET:/session/check/{session_id}',
            'POST:/session/touch/{session_id}',
            'POST:/session/logout/{session_id}'
        ],
        'rate_limit' => [
            'window_seconds' => 60,
            'max_requests' => 30
        ]
    ],
    'REPLACE_WITH_GENERATED_API_KEY_3' => [
        'name' => 'Info Only Application',
        'permissions' => ['user_info', 'user_properties'], // Can access user info and specific properties
        'routes' => [
            'POST:/login',
            'POST:/validate/{session_id}',
            'GET:/session/check/{session_id}',
            'GET:/user/{session_id}/info',
            'GET:/user/{session_id}/properties'
        ],
        // No custom rate_limit = uses default from config.json
        // Restrict to basic properties only
        'allowed_properties' => ['Vorname', 'Name', 'E-Mail']
    ],
    'REPLACE_WITH_GENERATED_API_KEY_4' => [
        'name' => 'Delegation Service',
        'permissions' => ['delegate'], // Can create delegated sessions for other apps
        'routes' => [
            'POST:/login',
            'POST:/session/delegate/{session_id}'
        ],
        'rate_limit' => [
            'window_seconds' => 300,  // 5 minutes
            'max_requests' => 10      // Low limit for delegation
        ]
    ]
];

// ============================================================================
// SETUP INSTRUCTIONS
// ============================================================================
// 1. Copy this file: cp config/secrets.php.example config/.secrets.php
// 2. Generate encryption key: php -r "echo 'base64:' . base64_encode(random_bytes(32)) . PHP_EOL;"
// 3. Generate API keys: php -r "require 'keygenerator.php'; echo generateApiKey(32) . PHP_EOL;"
// 4. Edit config/.secrets.php and replace all placeholder values
// 5. Configure API key permissions according to your needs
// 6. Verify config/.secrets.php is in .gitignore
// 7. Set proper permissions: chmod 600 config/.secrets.php
